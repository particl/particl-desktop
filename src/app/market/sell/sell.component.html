<app-header class="disable-select">
  <mat-tab-group (selectChange)="changeTab($event.index)">
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="icon" fontSet="partIcon" fontIcon="part-overview"></mat-icon>
        Listings
      </ng-template>
    </mat-tab>
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="icon" fontSet="partIcon" fontIcon="part-hamburger"></mat-icon>
        Orders
      </ng-template>
    </mat-tab>
    <mat-tab>
      <ng-template mat-tab-label>
        <mat-icon class="icon" fontSet="partIcon" fontIcon="part-circle-plus"></mat-icon>
        Sell item
      </ng-template>
    </mat-tab>
  </mat-tab-group>
</app-header>


<div fxLayout="row" fxLayoutGap="30px" class="container-block">

  <!-- Listings > Filter -->
  <div class="filter" fxFlex="0 0 230px" *ngIf="tabLabels[selectedTab] == 'listings'">

    <div class="sell-item">
      <button mat-raised-button color="primary" (click)="addItem()" class="full-width" matTooltip="Enter a new item for sale" matTooltipPosition="above">
        <mat-icon fontSet="partIcon" fontIcon="part-circle-plus"></mat-icon>
        Add new listing
      </button>
    </div>

    <div class="section search-sorting">
      <div class="subtitle">Search &amp; sort</div>
      <mat-card class="filter-card">
        <mat-form-field class="icon-input filter-input" floatPlaceholder="never">
          <input matInput type="text" class="header-input" placeholder="Search listings" [(ngModel)]="filters.search" (keyup)="loadPage()" (keyup.enter)="loadPage()" (keyup.escape)="filters.search = ''; loadPage()">
          <mat-icon *ngIf="filters.search" matTooltip="Clear" fontSet="partIcon" fontIcon="part-clear-all" (click)="filters.search=''; loadPage()"></mat-icon>
          <mat-icon *ngIf="!filters.search" matTooltip="Search" fontSet="partIcon" fontIcon="part-search" (click)="loadPage()"></mat-icon>
        </mat-form-field>
        <!--mat-form-field class="sort-by filter-input" floatPlaceholder="never">
          <mat-select placeholder="Sort listings">
            <mat-option *ngFor="let sorting of listing_sortings" [value]="sorting.value">
              {{ sorting.title }}
            </mat-option>
          </mat-select>
        </mat-form-field -->
      </mat-card>
    </div>

    <!--div class="section filter-by-type TO_DO">
      <div class="subtitle">Filter by status</div>
      <mat-card class="filter-card">
        <mat-radio-group class="radio-group block-radio">
          <mat-radio-button class="filter-option" *ngFor="let status of listing_filtering" value="{{ status.value }}">
            {{ status.title }}
            <span class="amount">{{ status.amount }}</span>
          </mat-radio-button>
        </mat-radio-group>
      </mat-card>
    </div--><!-- .filter-by-type -->

    <button mat-button color="warn" class="clear-filters" (click)="clear()">
      <mat-icon fontSet="partIcon" fontIcon="part-clear-all"></mat-icon>
      Clear all filters
    </button>

  </div><!-- .filter -->

  <!-- Orders > Filter -->
  <div class="filter" fxFlex="0 0 230px" *ngIf="tabLabels[selectedTab] == 'orders'">

    <div class="section search-sorting">
      <div class="subtitle first">Search &amp; sort</div>
      <mat-card class="filter-card">
        <mat-form-field class="icon-input filter-input" floatPlaceholder="never">
          <input matInput type="text" class="header-input" placeholder="Search orders" [(ngModel)]="filters.search" (keyup.enter)="loadPage()" (keyup.escape)="filters.search = ''; loadPage()">
          <mat-icon *ngIf="filters.search" matTooltip="Clear" fontSet="partIcon" fontIcon="part-clear-all" (click)="filters.search=''; loadPage()"></mat-icon>
          <mat-icon *ngIf="!filters.search" matTooltip="Search" fontSet="partIcon" fontIcon="part-search" (click)="loadPage()"></mat-icon>
        </mat-form-field>
        <mat-form-field class="sort-by filter-input" floatPlaceholder="never">
          <mat-select placeholder="Sort orders">
            <mat-option *ngFor="let sorting of order_sortings" [value]="sorting.value">
              {{ sorting.title }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </mat-card>
    </div>

    <div class="section filter-by-type">
      <div class="subtitle">Filter by status</div>
      <mat-card class="filter-card">
        <mat-radio-group class="radio-group block-radio">
          <mat-radio-button class="filter-option" *ngFor="let status of order_filtering" value="{{ status.value }}">
            {{ status.title }}
            <!-- FIXME: show amount (below) only if higher than 1 -->
            <span class="amount">{{ status.amount }}</span>
          </mat-radio-button>
        </mat-radio-group>
      </mat-card>
    </div><!-- .filter-by-type -->

    <button mat-button color="warn" class="clear-filters" (click)="clear()">
      <mat-icon fontSet="partIcon" fontIcon="part-clear-all"></mat-icon>
      Clear all filters
    </button>

  </div><!-- .filter -->


  <!-- Listings > list -->
  <div class="listings list section" fxFlex="1 1 100%" *ngIf="tabLabels[selectedTab] == 'listings'">

    <div class="no-results" *ngIf="listings?.length === 0">
      You don't have any market listings yet
    </div>
    <!--div class="subtitle first">Published listings</div-->

    <mat-expansion-panel class="listing item no-padding" *ngFor="let listing of listings">
      <mat-expansion-panel-header class="header">
        <div class="header-wrapper" fxLayout="row" fxLayoutAlign="space-between center">
          <div class="photo" fxFlex="0 0 110px">
            <img src="./assets/images/placeholder_1-1.jpg">
          </div>
          <div class="meta" fxFlex="1 1 100%">
            <div class="name">{{ listing.title }}</div>
            <div class="categories">{{ listing.category.name }}</div>
            <div class="date">
              <!--span class="hash" matTooltip="Order hash">AGR</span-->
              Added {{ listing.createdAt }} &bull; Expires 2018-02-13
            </div>
          </div>
          <div class="status {{listing.statusClass}}" fxFlex="0 0 140px"><span>&bull;</span>{{listing.status}}</div>
        </div>
      </mat-expansion-panel-header>

      <div class="status-info">
        <!--p>{{ listing.status_info }}</p-->
      </div>

      <div class="detail" fxLayout="row" fxLayoutGap="30px">
        <div class="description" fxFlex="65%">
          <div class="title">Listing description</div>
          <p>
            {{ listing.longDescription }}
          </p>
        </div><!-- .description -->
        <div class="info" fxFlex="35%">
          <div class="title">Price & Qty</div>
          <table class="prices">
            <!--tr><th>Quantity</th><td>2</td></tr-->
            <tr><th>Price per item</th><td>23.<small>1285</small> PART</td></tr>
            <!--tr><th>Total price</th><td>46.<small>257</small> PART</td></tr-->
          </table>
        </div>
      </div>

      <mat-action-row fxLayout fxLayoutAlign="space-between stretch">
        <div class="left">
          <button mat-button color="warn" matTooltip="Delete listing" (click)="confirmDeleteListing(listing.id)" class="small">
            <mat-icon fontSet="partIcon" fontIcon="part-cross"></mat-icon>
          </button>
          <button mat-button matTooltip="Clone listing" (click)="addItem(listing.id, true)" class="small">
            <mat-icon fontSet="partIcon" fontIcon="part-copy"></mat-icon>
          </button>
          <button mat-button matTooltip="Edit listing details" (click)="addItem(listing.id)" class="small">
            <mat-icon fontSet="partIcon" fontIcon="part-pen-1"></mat-icon>
            Edit listing
          </button>
        </div>
        <div class="right"> <!-- listing.action_color  -->
          <button mat-raised-button color="primary" matTooltip="listing.action_tooltip" [disabled]="false"> <!-- listing.action_disabled -->
            <mat-icon fontSet="partIcon" fontIcon="part-date"></mat-icon> <!-- listing.action_icon -->
             listing.action_button
          </button>
        </div>
      </mat-action-row>
    </mat-expansion-panel><!-- .listing -->

    <!--div class="subtitle">Unpublished listings (templates)</div-->

  </div><!-- .listings-list -->


  <!-- Orders > list -->
  <div class="orders list section" fxFlex="1 1 100%" *ngIf="tabLabels[selectedTab] == 'orders'">

    <div class="no-results">
      You don't have any market orders yet
    </div>

    <mat-expansion-panel class="order item no-padding" *ngFor="let order of orders">
      <mat-expansion-panel-header class="header">
        <div class="header-wrapper" fxLayout="row" fxLayoutAlign="space-between center">
          <div class="photo" fxFlex="0 0 80px">
            <img src="./assets/images/placeholder_1-1.jpg">
          </div>
          <div class="meta" fxFlex="1 1 100%">
            <div class="name">{{ order.name }}</div>
            <div class="date">
              <!-- TODO: 3-letter "hash" as semi-unique order ID (generated randomly or e.g. by first letters of TXID) + randomized background color based on the hash -->
              <span class="hash {{ order.hash_bg }}" matTooltip="Order hash">{{ order.hash }}</span>
              Added 2018-02-19 &bull; Updated 2018-02-13
            </div>
          </div>
          <div class="status {{ order.status }}" fxFlex="0 0 120px"><span>&bull;</span>{{ order.status }}</div>
        </div>
      </mat-expansion-panel-header>

      <div class="status-info">
        <p>{{ order.status_info }}</p>
      </div>

      <div class="detail" fxLayout="row" fxLayoutGap="30px">
        <div class="buyer-info" fxFlex="27%">
          <div class="title">Shipping address</div>
          <p>Mr. Longname Buyer<br>Particl Avenue X/144<br>5RFG4 United Cryptocity<br>Universe</p>
        </div><!-- .buyer-info -->
        <div class="info" fxFlex="35%">
          <div class="title">Price & Qty</div>
          <table class="prices">
            <tr><th>Quantity</th><td>2</td></tr>
            <tr><th>Price per item</th><td>23.<small>1285</small> PART</td></tr>
            <tr><th>Total price</th><td>46.<small>257</small> PART</td></tr>
          </table>
        </div>
        <div class="order-history" fxFlex="32%">
          <div class="title">Order history</div>
          <table>
            <!--tr><td class="date">2018-02-24</td><td class="status shipped">Sold</td></tr-->
            <!--tr><td class="date">2018-02-14</td><td class="status shipped">Shipped</td></tr-->
            <tr><td class="date">2018-02-11</td><td class="status escrow">In escrow</td></tr>
            <tr><td class="date">2018-02-10</td><td class="status bidding">Bidding</td></tr>
          </table>
        </div>
      </div>

      <mat-action-row fxLayout fxLayoutAlign="space-between stretch">
        <div class="left">
          <button mat-button color="warn" matTooltip="Reject & cancel order" (click)="confirmDeleteListing()" class="small">
            <mat-icon fontSet="partIcon" fontIcon="part-cross"></mat-icon>
          </button>
          <button mat-button matTooltip="Edit order" class="small">
            <mat-icon fontSet="partIcon" fontIcon="part-pen-1"></mat-icon>
            Edit
          </button>
          <!-- TODO: link to TX ID on block explorer (if payment was made already) -->
          <button mat-button matTooltip="View payment ID" class="small">
            <mat-icon fontSet="partIcon" fontIcon="part-stake"></mat-icon>
          </button>
          <!-- TODO: shortcut to e2e message to buyer -->
          <button mat-button class="small">
            <mat-icon fontSet="partIcon" fontIcon="part-person-edit"></mat-icon>
            Contact buyer
          </button>
        </div>
        <div class="right">
          <!-- TODO: after clicking, show confirmation modal with more info: -->
          <button mat-raised-button color="primary" matTooltip="{{ order.action_tooltip }}" [disabled]="order.action_disabled">
            <mat-icon fontSet="partIcon" fontIcon="{{ order.action_icon }}"></mat-icon>
            {{ order.action_button }}
          </button>
        </div>
      </mat-action-row>
    </mat-expansion-panel><!-- .order -->

  </div><!-- .orders.list -->

</div><!-- .container-block -->
